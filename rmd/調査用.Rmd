---
title: "SQL"
author: "kotsubotakuto"
date: "2017年10月6日"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# install.packages("DBI")
# install.packages("RPostgreSQL")
library(DBI)  # 必須ではないらしい
library(RPostgreSQL)
library(dplyr)
```

```{r}
con <- dbConnect(PostgreSQL(), host="192.168.11.16", 
                 port=5432, 
                 dbname="datacom2017", 
                 user="postgres", 
                 password="postgres")

scan_query <- function(query_path) {
  return (
    scan(query_path, what='', quote='', sep='\n', comment.char = '', encoding='UTF-8') %>% 
      gsub(pattern='--.*$', replacement='') %>% # 正規表現でコメントアウトを消す
      paste0(collapse=' ')
  )
}

sql <- scan_query("C:/Users/SHIO-160412-4/Desktop/data-competition/sql/tmp.sql")

dbGetQuery(con,"SET CLIENT_ENCODING TO 'shift-jis';")
dataset <- dbGetQuery(con,sql)
print(dataset)
```
